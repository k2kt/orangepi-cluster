# 2万円で12コアの並列化計算機をつくる

## はじめに

夏休みなのでクラスターPCをつくった。つくるのが目的なので性能は最低限でいい。なんなら可能な限り安くつくりたい。そうなるとシングルボードコンピュータが候補になるが、昨今の半導体不足と円安の影響でRasberry Pi の価格が3~5倍に急騰していた。AliexpressでRaspberry PiのパチもんみたいなOrange Piなるものが価格そのままで在庫があったので買ってみた。技適が通ってないのでwifiとbluetoothは使っちゃだめ。マギシステムみたいでかっこいいので3台構成にした。

## Orange Piについて

## 構想

Orange Pi 3 LTS (以下Orange Pi)  3台をスイッチングハブでつなげて４コア×3の12コアを構築する。





それぞれ名前を**nebula**、**hugo**、**locus**にした。3人組、3部作、いろいろあるので名前つけるのは楽しい。ちゃんとやるなら**server001**、**server002**みたいにしたほうがいい。
本来は普段使ってるwindows PCのWSL2をマスター兼ファイルサーバーにしようとしたがWSL2の固定IP化がよくわからなかったので断腸の思いで**nebula**をマスターにした。

## 必要なもの

| 機材  | 製品  | 購入場所 | 価格  | 備考  |
| --- | --- | --- | --- | --- |
| SBC | Orange Pi 3 LTS | Aliexpress | 5860円くらい×3つ |発売日より値上がりしてる|
| スイッチングハブ | TD  | メルカリ | 1000円くらい | だいたいこのくらいの相場で見つかる|
| micro SD 64GB | a   | メルカリ | 800円×3つ | 適当に一番安いやつ<br>class10は大事 |
| LANケーブル | ダイソーのやつ | DAISO | 110円 × 4つ | たぶん自作のほうが安いが面倒 |
| USB-A-USB-C | ダイソーのやつ | DAISO | 110円 × 3つ |     |
| HDMIケーブル | ダイソーのやつ | DAISO | 110円 | 半年くらいで壊れた前科あり |
| モニター | 家にあったやつ | -   | -   | みんな持ってる |
| USB-ACアダプター | 家にあったやつ | -   | -   | みんな持ってる |
| マウス | 家にあったやつ | -   | -   | みんな持ってる |
| キーボード | 家にあったやつ | -   | -   | みんな持ってる |
|PC|家にあったやつ|-|-|ネットにつながってmicro SDの読み書きができるもの|
SBC以外は適当に手に入るもので一番安いものにしたら2万円以内に収めることができた。
micro SD は16GBにすればもっと安い（容量的に十分）。
2万円は後付けだが、だいたいそのくらいに収まると思う。

## インストールメディアを作成

### 1\. [Rasberry pi Imager](https://www.raspberrypi.com/software/operating-systems/) からRasberry pi Imagerをインストール

windows 11 64bitなのでをダウンロードし指示に従ってインストール

### 2\. Orange Pi 公式からイメージファイルをダウンロード

softwareのタグからOrange Pi 3 LTSを探す。google cloudのページに飛ぶのでそこからイメージファイルをダウンロードできる。
cluster作成用途だとGUIは不要なのでserverを選択。とりあえず最新版にした。

### 3\. インストールメディアにイメージファイルを焼く

Orange Pi 3 LTSにはMicro SDスロットがあるのでMicro SDに焼くことにした。容量は16GBもあれば十分っぽいが適当に64GB×3つ購入した。速度的にはclass10がいい。相性問題かわからないが1つだけ異常に動作が遅かった。何度かフォーマットしなおして再インストールを試したが変わらなかったのでNintendo Switchから引っこ抜いた16GBのものにしたら問題なく動作した。

Rasberry pi Imager を起動するとイメージファイル、ストレージを選択する画面になる。一応FAT32でフォーマットをかける。ダウンロードしてきたイメージファイルをOSに選んでストレージを用意したmicro SDに指定して開始すれば焼ける。
設定ではホスト名等を指定できるがインストール後に起動したら反映されておらずorange piに直されていた。

## Orange Piを起動

用意したインストールメディアをスロットに差し、USB-Cをつなぐと起動してLEDが点灯する。しばらく待つとOS起動画面になる。デフォルトでは`user=root` `pass=orangepi`でログインできる。
ログインしたらとりあえずいろいろアップデート

```
sudo apt-get install update
sudo apt-get install upgrade
```

## ホスト名の変更、IPアドレスの固定

クラスターを構築する際にそれぞれのノードのホスト名とIPアドレスを決めておくと迷子にならない。ホスト名の変更方法、IPアドレスの固定方法はいくつかあるが、どちらも`orangepi-config`を使うと簡単。他の方法をいくつか試したが、反映されなかったり再ログインでもとに戻ったりした。
IPアドレスの固定の前に構成を確認する。
ゲートウェイの確認
